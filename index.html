<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—â–Ω—ã–π –±–µ–Ω—á–º–∞—Ä–∫ "–ó–∞–π—Ü—ã" 2D/3D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .top-stats {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(20, 20, 40, 0.95);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 3px solid #ff4757;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            min-width: 80px;
        }

        #fpsValue {
            color: #ff4757;
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.7);
        }

        #rabbitCount {
            color: #2ed573;
            text-shadow: 0 0 10px rgba(46, 213, 115, 0.7);
        }

        .stat-label {
            color: #a4b0be;
            font-size: 1.1rem;
        }

        .main-container {
            padding-top: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding-bottom: 50px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 0 20px;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            background: linear-gradient(to right, #ff6b6b, #ffa502, #2ed573, #1e90ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.3rem;
            color: #a4b0be;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

        .mode-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-btn {
            padding: 15px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #a4b0be;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 180px;
            text-align: center;
        }

        .mode-btn.active {
            background: linear-gradient(145deg, #ff6b6b, #ff4757);
            color: white;
            border-color: #ff4757;
            box-shadow: 0 0 25px rgba(255, 71, 87, 0.5);
            transform: translateY(-5px);
        }

        .mode-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .benchmark-area {
            width: 100%;
            height: 600px;
            background: rgba(10, 10, 20, 0.9);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
            border: 3px solid rgba(255, 71, 87, 0.3);
            margin-bottom: 30px;
        }

        #canvas2D, #canvas3D {
            width: 100%;
            height: 100%;
            display: block;
        }

        #canvas3D {
            display: none;
        }

        .controls {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-group {
            background: rgba(30, 30, 60, 0.8);
            border-radius: 15px;
            padding: 25px;
            min-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 71, 87, 0.2);
        }

        .control-title {
            color: #ffa502;
            font-size: 1.4rem;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 165, 2, 0.3);
        }

        .slider-container {
            margin-bottom: 20px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #a4b0be;
            font-size: 1.1rem;
        }

        input[type="range"] {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #ff6b6b, #ffa502, #2ed573);
            border-radius: 6px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            border: 3px solid #1e90ff;
        }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }

        button {
            padding: 18px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
        }

        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        button:active:not(:disabled) {
            transform: translateY(1px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #startBtn {
            background: linear-gradient(145deg, #2ed573, #1dd1a1);
            color: white;
        }

        #stopBtn {
            background: linear-gradient(145deg, #ff6b6b, #ff4757);
            color: white;
        }

        #resetBtn {
            background: linear-gradient(145deg, #3742fa, #5352ed);
            color: white;
        }

        .instructions {
            background: rgba(30, 30, 60, 0.8);
            border-radius: 15px;
            padding: 25px;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(30, 144, 255, 0.2);
        }

        .instructions h3 {
            color: #1e90ff;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
        }

        .instructions-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .instruction-section {
            padding: 15px;
        }

        .instruction-section h4 {
            color: #ffa502;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .instruction-section ul {
            padding-left: 20px;
            color: #a4b0be;
            line-height: 1.6;
        }

        .instruction-section li {
            margin-bottom: 8px;
        }

        .warning {
            background: rgba(255, 71, 87, 0.15);
            border: 2px solid rgba(255, 71, 87, 0.5);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            color: #ffcccc;
            font-size: 1.1rem;
        }

        .results-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(15px);
        }

        .results-overlay.active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .results-container {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border-radius: 25px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.8);
            border: 4px solid #ff4757;
            position: relative;
            overflow: hidden;
        }

        .results-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(255, 71, 87, 0.1) 50%, 
                transparent 70%);
            animation: shine 3s infinite linear;
            z-index: 0;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .results-content {
            position: relative;
            z-index: 1;
        }

        .results-title {
            color: #ff4757;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 71, 87, 0.7);
        }

        .final-score {
            font-size: 5rem;
            text-align: center;
            color: #2ed573;
            margin: 30px 0;
            text-shadow: 0 0 30px rgba(46, 213, 115, 0.7);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin: 40px 0;
        }

        .result-item {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .result-item h4 {
            color: #ffa502;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .result-item p {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
        }

        .performance-rating {
            text-align: center;
            font-size: 1.8rem;
            padding: 20px;
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            border: 2px solid rgba(30, 144, 255, 0.3);
        }

        .close-results {
            display: block;
            margin: 30px auto 0;
            padding: 15px 40px;
            background: linear-gradient(145deg, #ff4757, #ff6b6b);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-results:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.7);
        }

        .benchmark-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            color: #ffa502;
            z-index: 10;
        }

        @media (max-width: 768px) {
            .top-stats {
                padding: 10px 15px;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .benchmark-area {
                height: 400px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-group {
                width: 100%;
                max-width: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="top-stats">
        <div class="stat-item">
            <span class="stat-label">FPS:</span>
            <span class="stat-value" id="fpsValue">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">–ó–∞–π—Ü–µ–≤:</span>
            <span class="stat-value" id="rabbitCount">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">–†–µ–∂–∏–º:</span>
            <span class="stat-value" id="modeValue">2D</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">–°—Ç–∞—Ç—É—Å:</span>
            <span class="stat-value" id="statusValue">–û–∂–∏–¥–∞–Ω–∏–µ</span>
        </div>
    </div>

    <div class="main-container">
        <div class="header">
            <h1>–ú–æ—â–Ω—ã–π –±–µ–Ω—á–º–∞—Ä–∫ "–ó–∞–π—Ü—ã"</h1>
            <div class="subtitle">
                –ó–∞–∂–º–∏—Ç–µ –ª–µ–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –≤ —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–π—Ü–µ–≤. 
                –¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 0 FPS. 
                –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π FPS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –≤–∞—à–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∞.
            </div>
            
            <div class="mode-selector">
                <div class="mode-btn active" data-mode="2D">2D –†–µ–∂–∏–º</div>
                <div class="mode-btn" data-mode="3D">3D –†–µ–∂–∏–º</div>
            </div>
        </div>

        <div class="benchmark-area">
            <canvas id="canvas2D"></canvas>
            <canvas id="canvas3D"></canvas>
            <div class="benchmark-info">
                –ó–∞–∂–º–∏—Ç–µ –õ–ö–ú –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–π—Ü–µ–≤ ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –¥–ª—è –∞–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <div class="control-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–π—Ü–µ–≤</div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>–°–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–π—Ü–µ–≤:</span>
                        <span id="complexityValue">–°—Ä–µ–¥–Ω—è—è</span>
                    </div>
                    <input type="range" id="complexitySlider" min="1" max="3" value="2" step="1">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>–°–∫–æ—Ä–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:</span>
                        <span id="spawnRateValue">50/—Å–µ–∫</span>
                    </div>
                    <input type="range" id="spawnRateSlider" min="10" max="200" value="50" step="10">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>–†–∞–∑–º–µ—Ä –∑–∞–π—Ü–µ–≤:</span>
                        <span id="sizeValue">–°—Ä–µ–¥–Ω–∏–π</span>
                    </div>
                    <input type="range" id="sizeSlider" min="1" max="3" value="2" step="1">
                </div>
            </div>

            <div class="control-group">
                <div class="control-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–º</div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>–¶–µ–ª–µ–≤–æ–π FPS:</span>
                        <span id="targetFpsValue">0</span>
                    </div>
                    <input type="range" id="targetFpsSlider" min="0" max="60" value="0" step="1">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>–í—Ä–µ–º—è —Ç–µ—Å—Ç–∞:</span>
                        <span id="testTimeValue">0 —Å–µ–∫</span>
                    </div>
                    <input type="range" id="testTimeSlider" min="10" max="300" value="60" step="10">
                </div>
                
                <div class="buttons">
                    <button id="startBtn">
                        <span>‚ñ∂Ô∏è</span> –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                    </button>
                    <button id="stopBtn" disabled>
                        <span>‚è∏Ô∏è</span> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    </button>
                    <button id="resetBtn">
                        <span>üîÑ</span> –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <div class="instructions">
            <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–µ–Ω—á–º–∞—Ä–∫–∞</h3>
            <div class="instructions-content">
                <div class="instruction-section">
                    <h4>–û—Å–Ω–æ–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h4>
                    <ul>
                        <li><strong>–ó–∞–∂–º–∏—Ç–µ –õ–ö–ú</strong> - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–π—Ü–µ–≤ –≤ –º–µ—Å—Ç–æ –∫–ª–∏–∫–∞</li>
                        <li><strong>–ü–†–û–ë–ï–õ</strong> - –∞–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–π—Ü–µ–≤ –ø–æ –≤—Å–µ–º—É —ç–∫—Ä–∞–Ω—É</li>
                        <li><strong>ESC</strong> - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ—Å—Ç–∞</li>
                        <li><strong>R</strong> - —Å–±—Ä–æ—Å —Ç–µ—Å—Ç–∞</li>
                        <li><strong>1/2</strong> - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É 2D –∏ 3D —Ä–µ–∂–∏–º–∞–º–∏</li>
                    </ul>
                </div>
                <div class="instruction-section">
                    <h4>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∞</h4>
                    <ul>
                        <li>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π FPS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π</li>
                        <li>–¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ 0 FPS</li>
                        <li>–ß–µ–º –±–æ–ª—å—à–µ –∑–∞–π—Ü–µ–≤ –≤—ã–¥–µ—Ä–∂–∏—Ç —Å–∏—Å—Ç–µ–º–∞ - —Ç–µ–º –ª—É—á—à–µ</li>
                        <li>3D —Ä–µ–∂–∏–º —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ GPU</li>
                        <li>2D —Ä–µ–∂–∏–º –Ω–∞–≥—Ä—É–∂–∞–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º CPU</li>
                    </ul>
                </div>
            </div>
            <div class="warning">
                ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç —Ç–µ—Å—Ç —Å–æ–∑–¥–∞—ë—Ç —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É. 
                –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
            </div>
        </div>
    </div>

    <div class="results-overlay" id="resultsOverlay">
        <div class="results-container">
            <div class="results-content">
                <div class="results-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–∞</div>
                <div class="final-score">
                    <span id="finalScore">0</span> –∑–∞–π—Ü–µ–≤
                </div>
                
                <div class="results-grid">
                    <div class="result-item">
                        <h4>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</h4>
                        <p id="resultMaxRabbits">0</p>
                    </div>
                    <div class="result-item">
                        <h4>–í—Ä–µ–º—è —Ç–µ—Å—Ç–∞</h4>
                        <p id="resultTestTime">0 —Å–µ–∫</p>
                    </div>
                    <div class="result-item">
                        <h4>–°—Ä–µ–¥–Ω–∏–π FPS</h4>
                        <p id="resultAvgFps">0</p>
                    </div>
                    <div class="result-item">
                        <h4>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π FPS</h4>
                        <p id="resultMinFps">0</p>
                    </div>
                </div>
                
                <div class="performance-rating" id="performanceRating">
                    –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...
                </div>
                
                <button class="close-results" id="closeResultsBtn">
                    –ó–∞–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                </button>
            </div>
        </div>
    </div>

    <!-- Three.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è 3D —Ä–µ–∂–∏–º–∞ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentMode = '2D';
        let testRunning = false;
        let benchmarkActive = false;
        let mousePressed = false;
        let autoSpawn = false;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        let rabbitCount = 0;
        let maxRabbits = 0;
        let fps = 0;
        let minFps = 999;
        let avgFps = 0;
        let fpsSamples = [];
        let startTime = 0;
        let lastSpawnTime = 0;
        let spawnRate = 50; // –∑–∞–π—Ü–µ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        let rabbitComplexity = 2; // 1-3
        let rabbitSize = 2; // 1-3
        let targetFps = 0;
        let maxTestTime = 60; // —Å–µ–∫—É–Ω–¥
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const fpsValue = document.getElementById('fpsValue');
        const rabbitCountElement = document.getElementById('rabbitCount');
        const modeValue = document.getElementById('modeValue');
        const statusValue = document.getElementById('statusValue');
        
        // 2D Canvas
        const canvas2D = document.getElementById('canvas2D');
        const ctx2D = canvas2D.getContext('2d');
        
        // 3D Canvas
        const canvas3D = document.getElementById('canvas3D');
        let scene3D, camera3D, renderer3D, rabbits3D = [];
        
        // –ó–∞–π—Ü—ã –¥–ª—è 2D —Ä–µ–∂–∏–º–∞
        let rabbits2D = [];
        
        // –ö–ª–∞—Å—Å –∑–∞–π—Ü–∞ –¥–ª—è 2D —Ä–µ–∂–∏–º–∞
        class Rabbit2D {
            constructor(x, y, complexity) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * (complexity * 2);
                this.vy = (Math.random() - 0.5) * (complexity * 2);
                this.size = 15 + Math.random() * 10 * rabbitSize;
                this.color = this.getRandomColor();
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.05 * complexity;
                this.energy = 100;
                this.complexity = complexity;
                
                // –î–ª—è —Å–ª–æ–∂–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
                this.phase1 = Math.random() * Math.PI * 2;
                this.phase2 = Math.random() * Math.PI * 2;
                this.phase3 = Math.random() * Math.PI * 2;
                this.speed1 = 0.05 + Math.random() * 0.05 * complexity;
                this.speed2 = 0.03 + Math.random() * 0.03 * complexity;
                this.speed3 = 0.02 + Math.random() * 0.02 * complexity;
                
                // –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞
                this.mass = this.size * 0.1;
                this.bounce = 0.8;
            }
            
            getRandomColor() {
                const colors = [
                    '#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2',
                    '#EF476F', '#9D4EDD', '#FF9E6D', '#70D6FF', '#FF70A6'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }
            
            update(deltaTime) {
                // –î–≤–∏–∂–µ–Ω–∏–µ
                this.x += this.vx * deltaTime * 60;
                this.y += this.vy * deltaTime * 60;
                
                // –û—Ç—Å–∫–æ–∫ –æ—Ç –≥—Ä–∞–Ω–∏—Ü
                if (this.x < this.size) {
                    this.x = this.size;
                    this.vx = Math.abs(this.vx) * this.bounce;
                }
                if (this.x > canvas2D.width - this.size) {
                    this.x = canvas2D.width - this.size;
                    this.vx = -Math.abs(this.vx) * this.bounce;
                }
                if (this.y < this.size) {
                    this.y = this.size;
                    this.vy = Math.abs(this.vy) * this.bounce;
                }
                if (this.y > canvas2D.height - this.size) {
                    this.y = canvas2D.height - this.size;
                    this.vy = -Math.abs(this.vy) * this.bounce;
                }
                
                // –ü–æ–≤–æ—Ä–æ—Ç
                this.rotation += this.rotationSpeed * deltaTime * 60;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–∑ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                this.phase1 += this.speed1 * deltaTime * 60;
                this.phase2 += this.speed2 * deltaTime * 60;
                this.phase3 += this.speed3 * deltaTime * 60;
                
                // –ù–µ–±–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
                this.vx += (Math.random() - 0.5) * 0.1 * this.complexity;
                this.vy += (Math.random() - 0.5) * 0.1 * this.complexity;
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
                const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                const maxSpeed = 5 * this.complexity;
                if (speed > maxSpeed) {
                    this.vx = (this.vx / speed) * maxSpeed;
                    this.vy = (this.vy / speed) * maxSpeed;
                }
                
                // –¢—Ä–µ–Ω–∏–µ
                this.vx *= 0.99;
                this.vy *= 0.99;
                
                // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
                this.vy += 0.1 * this.mass;
            }
            
            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                
                // –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é
                this.drawComplexRabbit(ctx);
                
                ctx.restore();
            }
            
            drawComplexRabbit(ctx) {
                // –¢–µ–ª–æ (—ç–ª–ª–∏–ø—Å —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π)
                const bodyWidth = this.size;
                const bodyHeight = this.size * 0.7 + Math.sin(this.phase1) * this.size * 0.1;
                
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.ellipse(0, 0, bodyWidth, bodyHeight, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—É—Ä—É –∫ —Ç–µ–ª—É
                ctx.fillStyle = this.getShadeColor(this.color, -30);
                for (let i = 0; i < 5; i++) {
                    const angle = (i / 5) * Math.PI * 2 + this.phase2;
                    const radius = bodyWidth * 0.7;
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * bodyHeight * 0.7;
                    const spotSize = this.size * 0.15;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, spotSize, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // –£—à–∏
                const earLength = this.size * 1.5 + Math.sin(this.phase3) * this.size * 0.2;
                const earWidth = this.size * 0.4;
                
                // –õ–µ–≤–æ–µ —É—Ö–æ
                ctx.fillStyle = this.color;
                ctx.save();
                ctx.rotate(Math.sin(this.phase1) * 0.3);
                ctx.beginPath();
                ctx.ellipse(-this.size * 0.6, -this.size * 1.2, earWidth, earLength, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                
                // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∞—Å—Ç—å –ª–µ–≤–æ–≥–æ —É—Ö–∞
                ctx.fillStyle = '#FFB6C1';
                ctx.save();
                ctx.rotate(Math.sin(this.phase1) * 0.3);
                ctx.beginPath();
                ctx.ellipse(-this.size * 0.6, -this.size * 1.2, earWidth * 0.6, earLength * 0.7, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                
                // –ü—Ä–∞–≤–æ–µ —É—Ö–æ
                ctx.fillStyle = this.color;
                ctx.save();
                ctx.rotate(Math.sin(this.phase2) * 0.3);
                ctx.beginPath();
                ctx.ellipse(this.size * 0.6, -this.size * 1.2, earWidth, earLength, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                
                // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∞—Å—Ç—å –ø—Ä–∞–≤–æ–≥–æ —É—Ö–∞
                ctx.fillStyle = '#FFB6C1';
                ctx.save();
                ctx.rotate(Math.sin(this.phase2) * 0.3);
                ctx.beginPath();
                ctx.ellipse(this.size * 0.6, -this.size * 1.2, earWidth * 0.6, earLength * 0.7, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                
                // –ì–ª–∞–∑–∞
                const eyeSize = this.size * 0.15;
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(-this.size * 0.3, -this.size * 0.2, eyeSize, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(this.size * 0.3, -this.size * 0.2, eyeSize, 0, Math.PI * 2);
                ctx.fill();
                
                // –ë–ª–µ—Å–∫ –≤ –≥–ª–∞–∑–∞—Ö
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(-this.size * 0.35, -this.size * 0.25, eyeSize * 0.3, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(this.size * 0.25, -this.size * 0.25, eyeSize * 0.3, 0, Math.PI * 2);
                ctx.fill();
                
                // –ù–æ—Å
                ctx.fillStyle = '#FF69B4';
                ctx.beginPath();
                ctx.arc(0, this.size * 0.1, this.size * 0.1, 0, Math.PI * 2);
                ctx.fill();
                
                // –£—Å—ã (6 —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π)
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 1;
                for (let i = 0; i < 3; i++) {
                    const offset = (i - 1) * 0.3;
                    const whiskerLength = this.size * 0.8 + Math.sin(this.phase1 + i) * this.size * 0.1;
                    
                    // –õ–µ–≤—ã–µ —É—Å—ã
                    ctx.beginPath();
                    ctx.moveTo(-this.size * 0.2, this.size * 0.1);
                    ctx.lineTo(-this.size * 0.2 - whiskerLength, this.size * 0.1 + offset * this.size);
                    ctx.stroke();
                    
                    // –ü—Ä–∞–≤—ã–µ —É—Å—ã
                    ctx.beginPath();
                    ctx.moveTo(this.size * 0.2, this.size * 0.1);
                    ctx.lineTo(this.size * 0.2 + whiskerLength, this.size * 0.1 + offset * this.size);
                    ctx.stroke();
                }
                
                // –õ–∞–ø—ã
                const pawSize = this.size * 0.3;
                const pawOffset = Math.sin(this.phase1) * this.size * 0.1;
                
                // –ü–µ—Ä–µ–¥–Ω–∏–µ –ª–∞–ø—ã
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.ellipse(-this.size * 0.4, this.size * 0.6 + pawOffset, pawSize, pawSize * 0.7, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(this.size * 0.4, this.size * 0.6 + pawOffset, pawSize, pawSize * 0.7, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // –ó–∞–¥–Ω–∏–µ –ª–∞–ø—ã (–±–æ–ª—å—à–µ)
                ctx.beginPath();
                ctx.ellipse(-this.size * 0.6, this.size * 0.4, pawSize * 1.2, pawSize * 0.9, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(this.size * 0.6, this.size * 0.4, pawSize * 1.2, pawSize * 0.9, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // –•–≤–æ—Å—Ç (–ø—É—à–∏—Å—Ç—ã–π —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π)
                const tailSize = this.size * 0.4 + Math.sin(this.phase3) * this.size * 0.1;
                ctx.fillStyle = 'white';
                ctx.beginPath();
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2 + this.phase3;
                    const x = Math.cos(angle) * tailSize * 0.5;
                    const y = this.size * 0.8 + Math.sin(angle) * tailSize * 0.5;
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.fill();
                
                // –î–µ—Ç–∞–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                if (this.complexity >= 2) {
                    // –ú–µ—Ö
                    ctx.strokeStyle = this.getShadeColor(this.color, 20);
                    ctx.lineWidth = 1;
                    for (let i = 0; i < 20; i++) {
                        const angle = Math.random() * Math.PI * 2;
                        const length = this.size * 0.1 + Math.random() * this.size * 0.1;
                        const startX = Math.cos(angle) * bodyWidth * 0.9;
                        const startY = Math.sin(angle) * bodyHeight * 0.9;
                        
                        ctx.beginPath();
                        ctx.moveTo(startX, startY);
                        ctx.lineTo(
                            startX + Math.cos(angle) * length,
                            startY + Math.sin(angle) * length
                        );
                        ctx.stroke();
                    }
                }
                
                if (this.complexity >= 3) {
                    // –¢–µ–Ω–∏
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                    ctx.beginPath();
                    ctx.ellipse(0, this.size * 0.2, bodyWidth * 0.9, bodyHeight * 0.3, 0, 0, Math.PI);
                    ctx.fill();
                }
            }
            
            getShadeColor(color, percent) {
                const num = parseInt(color.slice(1), 16);
                const amt = Math.round(2.55 * percent);
                const R = (num >> 16) + amt;
                const G = (num >> 8 & 0x00FF) + amt;
                const B = (num & 0x0000FF) + amt;
                
                return "#" + (
                    0x1000000 + 
                    (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
                    (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
                    (B < 255 ? B < 1 ? 0 : B : 255)
                ).toString(16).slice(1);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 3D —Å—Ü–µ–Ω—ã
        function init3DScene() {
            scene3D = new THREE.Scene();
            
            camera3D = new THREE.PerspectiveCamera(75, canvas3D.width / canvas3D.height, 0.1, 1000);
            camera3D.position.set(0, 50, 100);
            
            renderer3D = new THREE.WebGLRenderer({ 
                canvas: canvas3D,
                antialias: true,
                alpha: true
            });
            renderer3D.setSize(canvas3D.width, canvas3D.height);
            renderer3D.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            
            // –û—Å–≤–µ—â–µ–Ω–∏–µ
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene3D.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(100, 100, 50);
            scene3D.add(directionalLight);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ 3D –∑–∞–π—Ü–∞
        function create3DRabbit(x, y, complexity) {
            const group = new THREE.Group();
            
            // –¢–µ–ª–æ
            const bodyGeometry = new THREE.SphereGeometry(1, 16, 16);
            const bodyMaterial = new THREE.MeshLambertMaterial({ 
                color: Math.random() * 0xffffff 
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.scale.set(1, 0.7, 1);
            group.add(body);
            
            // –£—à–∏
            const earGeometry = new THREE.ConeGeometry(0.2, 2, 8);
            const earMaterial = new THREE.MeshLambertMaterial({ 
                color: Math.random() * 0xffffff 
            });
            
            const leftEar = new THREE.Mesh(earGeometry, earMaterial);
            leftEar.position.set(-0.4, 1.5, 0);
            leftEar.rotation.x = Math.PI / 6;
            group.add(leftEar);
            
            const rightEar = new THREE.Mesh(earGeometry, earMaterial);
            rightEar.position.set(0.4, 1.5, 0);
            rightEar.rotation.x = Math.PI / 6;
            group.add(rightEar);
            
            // –ì–ª–∞–∑–∞
            const eyeGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const eyeMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
            
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.3, 0.3, 0.9);
            group.add(leftEye);
            
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.3, 0.3, 0.9);
            group.add(rightEye);
            
            // –ù–æ—Å
            const noseGeometry = new THREE.SphereGeometry(0.15, 8, 8);
            const noseMaterial = new THREE.MeshLambertMaterial({ color: 0xFF69B4 });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.position.set(0, 0, 1);
            group.add(nose);
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            group.position.set(
                (x / canvas3D.width - 0.5) * 100,
                -(y / canvas3D.height - 0.5) * 100,
                0
            );
            
            scene3D.add(group);
            
            return {
                group: group,
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 2,
                vz: (Math.random() - 0.5) * 2,
                rotationSpeed: (Math.random() - 0.5) * 0.05,
                complexity: complexity
            };
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–π—Ü–µ–≤
        function addRabbit(x, y) {
            if (currentMode === '2D') {
                rabbits2D.push(new Rabbit2D(x, y, rabbitComplexity));
            } else {
                const rabbit3D = create3DRabbit(x, y, rabbitComplexity);
                rabbits3D.push(rabbit3D);
            }
            
            rabbitCount++;
            if (rabbitCount > maxRabbits) {
                maxRabbits = rabbitCount;
            }
            
            updateStats();
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–π—Ü–µ–≤
        function clearRabbits() {
            rabbits2D = [];
            rabbits3D = [];
            
            if (scene3D) {
                while(scene3D.children.length > 0) { 
                    scene3D.remove(scene3D.children[0]); 
                }
                init3DScene();
            }
            
            rabbitCount = 0;
            updateStats();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            rabbitCountElement.textContent = rabbitCount;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ FPS
            const now = performance.now();
            if (!startTime) startTime = now;
            
            const deltaTime = (now - lastFrameTime) / 1000;
            lastFrameTime = now;
            
            if (deltaTime > 0) {
                const currentFps = Math.min(999, Math.round(1 / deltaTime));
                fps = currentFps;
                
                if (currentFps < minFps) {
                    minFps = currentFps;
                }
                
                fpsSamples.push(currentFps);
                if (fpsSamples.length > 60) {
                    fpsSamples.shift();
                }
                
                avgFps = fpsSamples.reduce((a, b) => a + b, 0) / fpsSamples.length;
                
                fpsValue.textContent = Math.round(fps);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–≥–æ FPS
                if (targetFps > 0 && currentFps <= targetFps && testRunning) {
                    stopTest();
                    showResults();
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 0 FPS
                if (currentFps <= 0 && testRunning) {
                    stopTest();
                    showResults();
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ç–µ—Å—Ç–∞
            if (testRunning && benchmarkActive) {
                const elapsedTime = (now - startTime) / 1000;
                if (elapsedTime >= maxTestTime) {
                    stopTest();
                    showResults();
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            modeValue.textContent = currentMode;
            statusValue.textContent = testRunning ? '–¢–µ—Å—Ç –∏–¥–µ—Ç' : '–û–∂–∏–¥–∞–Ω–∏–µ';
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å–ª–∞–π–¥–µ—Ä–æ–≤
            document.getElementById('complexityValue').textContent = 
                ['–ù–∏–∑–∫–∞—è', '–°—Ä–µ–¥–Ω—è—è', '–í—ã—Å–æ–∫–∞—è'][rabbitComplexity - 1];
            document.getElementById('spawnRateValue').textContent = spawnRate + '/—Å–µ–∫';
            document.getElementById('sizeValue').textContent = 
                ['–ú–∞–ª–µ–Ω—å–∫–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–ë–æ–ª—å—à–æ–π'][rabbitSize - 1];
            document.getElementById('targetFpsValue').textContent = targetFps;
            document.getElementById('testTimeValue').textContent = maxTestTime + ' —Å–µ–∫';
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
        function startTest() {
            if (testRunning) return;
            
            testRunning = true;
            benchmarkActive = true;
            startTime = performance.now();
            
            // –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            fpsSamples = [];
            minFps = 999;
            avgFps = 0;
            
            updateUI();
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            requestAnimationFrame(gameLoop);
        }
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ—Å—Ç–∞
        function stopTest() {
            testRunning = false;
            benchmarkActive = false;
            autoSpawn = false;
            
            updateUI();
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
        
        // –°–±—Ä–æ—Å —Ç–µ—Å—Ç–∞
        function resetTest() {
            stopTest();
            clearRabbits();
            hideResults();
            
            // –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            maxRabbits = 0;
            updateStats();
        }
        
        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function showResults() {
            const resultsOverlay = document.getElementById('resultsOverlay');
            resultsOverlay.classList.add('active');
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            document.getElementById('finalScore').textContent = maxRabbits;
            document.getElementById('resultMaxRabbits').textContent = maxRabbits;
            document.getElementById('resultTestTime').textContent = 
                ((performance.now() - startTime) / 1000).toFixed(1) + ' —Å–µ–∫';
            document.getElementById('resultAvgFps').textContent = avgFps.toFixed(1);
            document.getElementById('resultMinFps').textContent = minFps.toFixed(1);
            
            // –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const rating = getPerformanceRating(maxRabbits);
            document.getElementById('performanceRating').textContent = rating;
        }
        
        function hideResults() {
            const resultsOverlay = document.getElementById('resultsOverlay');
            resultsOverlay.classList.remove('active');
        }
        
        function getPerformanceRating(rabbits) {
            if (rabbits >= 5000) return "üî• –ö–û–°–ú–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨!";
            if (rabbits >= 2000) return "‚ö° –ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û! –ò–≥—Ä–æ–≤–∞—è —Å—Ç–∞–Ω—Ü–∏—è";
            if (rabbits >= 1000) return "‚≠ê –û–¢–õ–ò–ß–ù–û! –ú–æ—â–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π –ü–ö";
            if (rabbits >= 500) return "üëç –•–û–†–û–®–û! –°—Ä–µ–¥–Ω–∏–π –∏–≥—Ä–æ–≤–æ–π –ü–ö";
            if (rabbits >= 200) return "‚úÖ –ù–û–†–ú–ê–õ–¨–ù–û! –û—Ñ–∏—Å–Ω—ã–π –ü–ö";
            if (rabbits >= 50) return "‚ö†Ô∏è –°–õ–ê–ë–û! –ë—é–¥–∂–µ—Ç–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ";
            return "‚ùå –û–ß–ï–ù–¨ –°–õ–ê–ë–û! –£—Å—Ç–∞—Ä–µ–≤—à–µ–µ –∂–µ–ª–µ–∑–æ";
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        let lastFrameTime = performance.now();
        
        function gameLoop(currentTime) {
            const deltaTime = (currentTime - lastFrameTime) / 1000;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            updateStats();
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–π—Ü–µ–≤ –ø—Ä–∏ –∑–∞–∂–∞—Ç–∏–∏ –º—ã—à–∏
            if ((mousePressed || autoSpawn) && testRunning) {
                const now = performance.now();
                if (now - lastSpawnTime > 1000 / spawnRate) {
                    if (mousePressed) {
                        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –º–µ—Å—Ç–æ –∫–ª–∏–∫–∞
                        addRabbit(mouseX, mouseY);
                    } else if (autoSpawn) {
                        // –ê–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ –≤—Å–µ–º—É —ç–∫—Ä–∞–Ω—É
                        const x = Math.random() * (currentMode === '2D' ? canvas2D.width : canvas3D.width);
                        const y = Math.random() * (currentMode === '2D' ? canvas2D.height : canvas3D.height);
                        addRabbit(x, y);
                    }
                    lastSpawnTime = now;
                }
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
            if (currentMode === '2D') {
                render2D(deltaTime);
            } else {
                render3D(deltaTime);
            }
            
            // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ü–∏–∫–ª–∞
            if (testRunning) {
                requestAnimationFrame(gameLoop);
            }
        }
        
        function render2D(deltaTime) {
            // –û—á–∏—Å—Ç–∫–∞ canvas
            ctx2D.fillStyle = 'rgba(10, 10, 20, 0.2)';
            ctx2D.fillRect(0, 0, canvas2D.width, canvas2D.height);
            
            // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∫–∏ (—Ñ–æ–Ω)
            ctx2D.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx2D.lineWidth = 1;
            const gridSize = 50;
            for (let x = 0; x < canvas2D.width; x += gridSize) {
                ctx2D.beginPath();
                ctx2D.moveTo(x, 0);
                ctx2D.lineTo(x, canvas2D.height);
                ctx2D.stroke();
            }
            for (let y = 0; y < canvas2D.height; y += gridSize) {
                ctx2D.beginPath();
                ctx2D.moveTo(0, y);
                ctx2D.lineTo(canvas2D.width, y);
                ctx2D.stroke();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –∑–∞–π—Ü–µ–≤
            for (const rabbit of rabbits2D) {
                rabbit.update(deltaTime);
                rabbit.draw(ctx2D);
            }
            
            // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –Ω–∞ canvas
            ctx2D.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx2D.fillRect(10, 10, 250, 60);
            ctx2D.fillStyle = 'white';
            ctx2D.font = 'bold 16px Arial';
            ctx2D.fillText(`–ó–∞–π—Ü–µ–≤: ${rabbitCount}`, 20, 35);
            ctx2D.fillText(`FPS: ${Math.round(fps)}`, 20, 55);
        }
        
        function render3D(deltaTime) {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 3D –∑–∞–π—Ü–µ–≤
            for (const rabbit of rabbits3D) {
                rabbit.group.position.x += rabbit.vx * deltaTime * 10;
                rabbit.group.position.y += rabbit.vy * deltaTime * 10;
                rabbit.group.position.z += rabbit.vz * deltaTime * 10;
                rabbit.group.rotation.y += rabbit.rotationSpeed * deltaTime * 10;
                
                // –û—Ç—Å–∫–æ–∫ –æ—Ç –≥—Ä–∞–Ω–∏—Ü
                const limit = 50;
                if (Math.abs(rabbit.group.position.x) > limit) rabbit.vx *= -1;
                if (Math.abs(rabbit.group.position.y) > limit) rabbit.vy *= -1;
                if (Math.abs(rabbit.group.position.z) > limit) rabbit.vz *= -1;
            }
            
            // –í—Ä–∞—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
            camera3D.position.x = Math.sin(currentTime * 0.001) * 100;
            camera3D.position.z = Math.cos(currentTime * 0.001) * 100;
            camera3D.lookAt(0, 0, 0);
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
            renderer3D.render(scene3D, camera3D);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        let mouseX = 0, mouseY = 0;
        
        function initEventListeners() {
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas
            function resizeCanvases() {
                canvas2D.width = canvas2D.offsetWidth;
                canvas2D.height = canvas2D.offsetHeight;
                
                if (canvas3D) {
                    canvas3D.width = canvas3D.offsetWidth;
                    canvas3D.height = canvas3D.offsetHeight;
                    
                    if (camera3D) {
                        camera3D.aspect = canvas3D.width / canvas3D.height;
                        camera3D.updateProjectionMatrix();
                    }
                    
                    if (renderer3D) {
                        renderer3D.setSize(canvas3D.width, canvas3D.height);
                    }
                }
            }
            
            window.addEventListener('resize', resizeCanvases);
            resizeCanvases();
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentMode = btn.dataset.mode;
                    
                    if (currentMode === '2D') {
                        canvas2D.style.display = 'block';
                        canvas3D.style.display = 'none';
                    } else {
                        canvas2D.style.display = 'none';
                        canvas3D.style.display = 'block';
                        if (!scene3D) init3DScene();
                    }
                    
                    updateUI();
                });
            });
            
            // –°–æ–±—ã—Ç–∏—è –º—ã—à–∏
            const benchmarkArea = document.querySelector('.benchmark-area');
            
            benchmarkArea.addEventListener('mousedown', (e) => {
                mousePressed = true;
                mouseX = e.offsetX;
                mouseY = e.offsetY;
                if (!testRunning) startTest();
            });
            
            benchmarkArea.addEventListener('mousemove', (e) => {
                mouseX = e.offsetX;
                mouseY = e.offsetY;
            });
            
            window.addEventListener('mouseup', () => {
                mousePressed = false;
            });
            
            benchmarkArea.addEventListener('touchstart', (e) => {
                mousePressed = true;
                const rect = benchmarkArea.getBoundingClientRect();
                mouseX = e.touches[0].clientX - rect.left;
                mouseY = e.touches[0].clientY - rect.top;
                if (!testRunning) startTest();
                e.preventDefault();
            });
            
            benchmarkArea.addEventListener('touchmove', (e) => {
                const rect = benchmarkArea.getBoundingClientRect();
                mouseX = e.touches[0].clientX - rect.left;
                mouseY = e.touches[0].clientY - rect.top;
                e.preventDefault();
            });
            
            window.addEventListener('touchend', () => {
                mousePressed = false;
            });
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏
            document.getElementById('startBtn').addEventListener('click', startTest);
            document.getElementById('stopBtn').addEventListener('click', stopTest);
            document.getElementById('resetBtn').addEventListener('click', resetTest);
            document.getElementById('closeResultsBtn').addEventListener('click', hideResults);
            
            // –°–ª–∞–π–¥–µ—Ä—ã
            document.getElementById('complexitySlider').addEventListener('input', (e) => {
                rabbitComplexity = parseInt(e.target.value);
                updateUI();
            });
            
            document.getElementById('spawnRateSlider').addEventListener('input', (e) => {
                spawnRate = parseInt(e.target.value);
                updateUI();
            });
            
            document.getElementById('sizeSlider').addEventListener('input', (e) => {
                rabbitSize = parseInt(e.target.value);
                updateUI();
            });
            
            document.getElementById('targetFpsSlider').addEventListener('input', (e) => {
                targetFps = parseInt(e.target.value);
                updateUI();
            });
            
            document.getElementById('testTimeSlider').addEventListener('input', (e) => {
                maxTestTime = parseInt(e.target.value);
                updateUI();
            });
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
            document.addEventListener('keydown', (e) => {
                switch(e.code) {
                    case 'Space':
                        autoSpawn = true;
                        if (!testRunning) startTest();
                        e.preventDefault();
                        break;
                    case 'Escape':
                        stopTest();
                        break;
                    case 'KeyR':
                        resetTest();
                        break;
                    case 'Digit1':
                        document.querySelector('[data-mode="2D"]').click();
                        break;
                    case 'Digit2':
                        document.querySelector('[data-mode="3D"]').click();
                        break;
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (e.code === 'Space') {
                    autoSpawn = false;
                }
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            initEventListeners();
            updateUI();
            
            // –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            function updateStatsLoop() {
                updateStats();
                requestAnimationFrame(updateStatsLoop);
            }
            updateStatsLoop();
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', init);
    </script>
</body>
</html>